# Prototype to process boxcar data


Load required packages and functions. 

```{r, message = FALSE}
library("MSnbase")
library("magrittr")
source("S01-bc-code.R")
```

Read the data in as an `MSnExp`

```{r}
f <- "./boxcar.mzML"
x <- readMSData(f, mode = "onDisk")
x
```

Data processing (see `S01-bc-code.R` for details):

1. Define boxcar groups

```{r}
fData(x)$groups <- bc_groups(x)
```

2. Keep only boxcar spectra

```{r}
xbc <- x[bc_is_boxcar(x)] 
```

3. Combine boxcar spectra and coerce result back to an `MSnExp` object

```{r, cache = TRUE}
res <- xbc %>%
    bc_zero_out_box(offset = 0.5) %>%
    combineSpectra(fcol = "groups",
                   method = boxcarCombine) %>%
    .as_MSnExp(f)

res
```

We have `r length(res)` spectra after processing.

Write to a new mzML file

```{r, eval = FALSE}
writeMSData(res, "boxcar_processed.mzML")
```

See also `sp_plot`,  `bc_plot` and `bc_plotly` for visualisation. 



[This figure](https://plotly.com/~lgatto/4/#/) shows a slice of a
combined spectrum with the different boxcar spectra in different
colours.



```{r}
sessionInfo()
```

References:

- [BoxCar acquisition method enables single-shot proteomics at a depth
  of 10,000 proteins in 100
  minutes](https://www.nature.com/articles/s41592-018-0003-5).
- [`MSnbase` - an R/Bioconductor package for isobaric tagged mass
  spectrometry data visualization, processing and
  quantitation](https://pubmed.ncbi.nlm.nih.gov/22113085/).
- `MSnbase` [webpage](http://lgatto.github.io/MSnbase/).
